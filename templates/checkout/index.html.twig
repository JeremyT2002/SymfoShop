{% extends 'catalog/base.html.twig' %}

{% block title %}Checkout - SymfoShop{% endblock %}
{% block meta_description %}Complete your order{% endblock %}

{% block body %}
    <h1>{{ 'checkout.title'|trans }}</h1>

    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin: 2rem 0;">
        <div>
            <div style="background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 2rem; margin-bottom: 2rem;">
                <h2 style="margin-bottom: 1.5rem;">{{ 'checkout.customer_information'|trans }}</h2>
                {{ form_start(customerForm, {'attr': {'style': 'display: grid; gap: 1rem;', 'id': 'customer-form', 'method': 'POST', 'action': path('checkout')}}) }}
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        {{ form_row(customerForm.firstName, {'attr': {'style': 'padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;'}}) }}
                        {{ form_row(customerForm.lastName, {'attr': {'style': 'padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;'}}) }}
                    </div>
                    {{ form_row(customerForm.email, {'attr': {'style': 'padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;'}}) }}
                    {{ form_row(customerForm.phone, {'attr': {'style': 'padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;'}}) }}
                {{ form_end(customerForm) }}
            </div>

            <div style="background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 2rem;">
                <h2 style="margin-bottom: 1.5rem;">{{ 'checkout.shipping_address'|trans }}</h2>
                {{ form_start(addressForm, {'attr': {'style': 'display: grid; gap: 1rem;', 'id': 'address-form'}}) }}
                    {{ form_row(addressForm.street, {'attr': {'style': 'padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;'}}) }}
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1rem;">
                        {{ form_row(addressForm.city, {'attr': {'style': 'padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;'}}) }}
                        {{ form_row(addressForm.postalCode, {'attr': {'style': 'padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;'}}) }}
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        {{ form_row(addressForm.country, {'attr': {'style': 'padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;'}}) }}
                        {{ form_row(addressForm.state, {'attr': {'style': 'padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;'}}) }}
                    </div>
                {{ form_end(addressForm) }}
                </div>
            </div>
        </div>

        <div>
            <div style="background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 1.5rem; position: sticky; top: 20px;">
                <h2 style="margin-bottom: 1.5rem;">{{ 'checkout.order_summary'|trans }}</h2>
                
                <div style="margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>Subtotal:</span>
                        <span>{{ (totals.subtotal / 100)|number_format(2, '.', ',') }} {{ totals.currency|escape }}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>{{ 'checkout.tax'|trans }}:</span>
                        <span>{{ (totals.taxTotal / 100)|number_format(2, '.', ',') }} {{ totals.currency|escape }}</span>
                    </div>
                </div>

                <div style="border-top: 2px solid #e5e5e5; padding-top: 1rem; margin-top: 1rem;">
                    <div style="display: flex; justify-content: space-between; font-size: 1.25rem; font-weight: bold; margin-bottom: 1.5rem;">
                        <span>Total:</span>
                        <span>{{ (totals.grandTotal / 100)|number_format(2, '.', ',') }} {{ totals.currency|escape }}</span>
                    </div>
                </div>

                <button type="button" id="place-order-btn" class="btn" style="width: 100%;">
                    {{ 'checkout.place_order'|trans }}
                </button>

                <p style="font-size: 0.85rem; color: #666; margin-top: 1rem; text-align: center;">
                    {{ 'checkout.terms_agreement'|trans }}
                </p>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('place-order-btn').addEventListener('click', function() {
            const customerForm = document.getElementById('customer-form');
            const addressForm = document.getElementById('address-form');
            const button = this;
            const originalText = button.innerHTML;
            
            if (customerForm && addressForm) {
                // Show loading state
                button.disabled = true;
                button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>{{ 'common.loading'|trans|e('js') }}...';
                
                // Show global loading overlay
                if (window.showLoading) {
                    window.showLoading();
                }
                
                // Submit customer form which will include address form data via handleRequest
                customerForm.submit();
            }
        });
    </script>
{% endblock %}

